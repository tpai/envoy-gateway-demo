<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Private Area</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 2rem; }
    .card { max-width: 720px; margin: 8vh auto; padding: 1.5rem; border: 1px solid #e5e7eb; border-radius: .5rem; }
    .row { margin-top: .75rem; display: flex; gap: .5rem; }
    button { padding: .55rem .9rem; border: 0; border-radius: .375rem; background: #111827; color: #fff; cursor: pointer; }
    .muted { color: #6b7280; }
    a { color: #2563eb; }
    .btn { padding: .55rem .9rem; border: 0; border-radius: .375rem; background: #111827; color: #fff; cursor: pointer; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Private Area</h1>
    <p class="muted">This page calls <code>/api/private</code>. If not authenticated, you will be redirected to <code>/login</code>.</p>
    <h3>API Response</h3>
    <pre id="out">(calling on load...)</pre>
    <ul>
      <li><a href="/">/</a></li>
      <li><a href="/login">/login</a></li>
      <li><a href="/private">/private</a></li>
    </ul>
  </div>
  <script>
    window.API_BASE = window.API_BASE || '{{API_BASE}}';
    const COOKIE_NAME = 'access_token';

    function getCookie(name) {
      return document.cookie.split('; ').map(v => v.trim()).reduce((acc, cur) => {
        const [k, ...rest] = cur.split('=');
        acc[k] = rest.join('=');
        return acc;
      }, {})[name];
    }

    async function callPrivateApi() {
      const token = getCookie(COOKIE_NAME);
      try {
        const res = await fetch((window.API_BASE || '') + '/api/private', {
          headers: { 'Authorization': `Bearer ${decodeURIComponent(token || '')}` }
        });
        if (res.status === 401 || res.status === 403) {
          const next = encodeURIComponent(location.pathname + location.search);
          location.replace(`/login?next=${next}`);
          return;
        }
        const text = await res.text();
        document.getElementById('out').textContent = text;
      } catch (err) {
        const next = encodeURIComponent(location.pathname + location.search);
        if (String(err).includes('Unauthenticated')) {
          location.replace(`/login?next=${next}`);
          return;
        }
        document.getElementById('out').textContent = `Request failed: ${err}`;
      }
    }

    // Call private API immediately on page load
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(callPrivateApi, 0);
    });
  </script>
 </body>
 </html>
